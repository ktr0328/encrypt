<!DOCTYPE html>
<html lang='en'>

<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0'>
  <meta http-equiv='X-UA-Compatible' content='ie=edge'>
  <title>encryption</title>
  <style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      color: #333333;
    }

    p {
      font-size: 13px;
    }

    hr {
      opacity: 0.3;
    }

    textarea:read-only {
      background-color: #CCCCCC
    }

    .half {
      display: grid;
      grid-template-columns: 50% 1fr;
    }
  </style>
</head>

<body>
  <h1>電子署名</h1>

  <hr>

  <h2>Step 1</h2>
  <p>登録情報 (数字10桁)を入力し、ハンコをもらうを押すと、ハンコがもらえます</p>
  <form id='getPrivateKey'>
    <input type='text' name='number' id='registerKey' placeholder="登録情報 (key)">
    <input type='submit' value='ハンコをもらう'>
  </form>
  <div>
    <h3>ハンコ</h3>
    <textarea id='privateKey' cols='50' rows='10' readonly></textarea>
  </div>

  <hr>

  <h2>Step 2</h2>
  <p>ハンコを押すと、暗号化されたデータを入手できます。(ハンコが押された状態)</p>
  <div id='encrypt-col' class='half'>
    <form id='encrypt'>
      <textarea name='data' id='fromRaw' cols='50' rows='10' placeholder="なんか適当なデータ (契約書的な)"></textarea>
      <input type='submit' value='ハンコを押す'>
    </form>
    <textarea id='encrypted' cols='50' rows='10' readonly></textarea>
  </div>

  <hr>

  <h2>Step 3</h2>
  <p>復号できることを確認します。</p>
  <form id='decrypt'>
    <textarea id='toRaw' cols='50' rows='10' readonly></textarea>
    <input type='submit' value='復号'>
  </form>
</body>

<script>
  const getPrivateKeyButton = document.querySelector('#getPrivateKey')
  const privateKeyText = document.querySelector('#privateKey')

  getPrivateKeyButton.addEventListener('submit', e => {
    e.preventDefault()
    const registerKey = document.querySelector('#registerKey').value
    const payload = {
      number: registerKey
    }

    fetch('http://localhost:3000', {
        body: JSON.stringify(payload),
        method: 'POST',
        headers: {
          'content-type': 'application/json'
        },
      }).then(res => res.json())
      .then(res => {
        privateKeyText.value = res.privateKey
      })
  })
</script>

</html>
